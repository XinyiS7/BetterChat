<!DOCTYPE html><html lang="zh"><head>    <meta charset="UTF-8">    <title>AI Chat</title>    <style>        body {            display: flex;            flex-direction: column;            font-family: sans-serif;            margin: 0;            height: 100vh;        }        header {            background-color: #eee;            padding: 10px;            font-weight: bold;        }        main {            display: flex;            flex: 1;        }        .sidebar-left, .sidebar-right {            width: 20%;            border-right: 1px solid #ccc;            padding: 10px;            box-sizing: border-box;        }        .sidebar-right {            border-right: none;            border-left: 1px solid #ccc;        }        .chat-window {            flex: 1;            padding: 10px;            box-sizing: border-box;            display: flex;            flex-direction: column;            justify-content: space-between;        }        .chat-content {            flex: 1;            border: 1px solid #aaa;            padding: 10px;            margin-bottom: 10px;            overflow-y: auto;        }        .control-panel {            display: flex;            align-items: center;            gap: 10px;            margin-bottom: 10px;        }        .input-area {            width: 100%;            height: 80px;        }        .section {            margin-bottom: 20px;        }        .checkbox-group {            display: flex;            flex-direction: column;        }        .chat-content {            height: 400px;            overflow-y: auto;            border: 1px solid #ccc;            padding: 10px;            background-color: #f9f9f9;        }        .chat-bubble {            max-width: 60%;            padding: 10px;            margin: 10px;            border-radius: 10px;            clear: both;            word-wrap: break-word;        }        .user-bubble {            background-color: #e6f7ff;            float: right;            text-align: right;        }        .ai-bubble {            background-color: #f6ffe6;            float: left;            text-align: left;        }    </style></head><body>    <header>AI chat</header>    <main>        <!-- 左侧对话列表 -->        <div class="sidebar-left">            <div class="section">                <h3>对话列表</h3>                <p>默认的长期保存对话，可通过点击加载到 chat window<br>保存在后端 django 数据库中</p>            </div>        </div>        <!-- 中间对话窗口 -->        <div class="chat-window">            <div class="chat-content">                <p><strong>chat window</strong><br>以左右分列的方式展示对话记录。可以渲染 markdown 文本</p>            </div>            <div class="control-panel">                <label><input type="checkbox" checked> mod</label>                <label><input type="checkbox" checked> abstr</label>                <label><input type="checkbox" checked> perm</label>                <button>↓</button>            </div>            <textarea id="chat-input" placeholder="请输入内容..." rows="3"></textarea>            <button id="send-button">发送</button>        </div>        <!-- 右侧 prompt 和临时对话 -->        <div class="sidebar-right">            <div id="prompt-section" class="section">                <h3>Prompt list</h3>                <!-- Prompt Checkbox 区域 -->                <div id="prompt-checkbox-group" class="checkbox-group">                    <label><input type="checkbox" name="prompt" value="选项一"> 选项一</label>                    <label><input type="checkbox" name="prompt" value="选项二"> 选项二</label>                    <label><input type="checkbox" name="prompt" value="选项三"> 选项三</label>                </div>                <!-- 管理按钮 -->                <button type="button" onclick="openPromptManager()">管理</button>            </div>            <!-- 弹出式 Prompt 管理窗口 -->            <div id="prompt-manager" style="display:none; position:fixed; top:20%; left:30%; background:#fff; border:1px solid #ccc; padding:20px; box-shadow: 0 0 10px #aaa;">                <h4>管理 Prompt 选项</h4>                <div id="prompt-edit-list"></div>                <!-- 添加新项 -->                <input type="text" id="new-prompt-input" placeholder="新增 prompt 内容">                <button type="button" onclick="addPromptOption()">添加</button>                <!-- 操作按钮 -->                <div style="margin-top:10px;">                    <button onclick="savePromptEdits()">保存</button>                    <button onclick="closePromptManager()">取消</button>                </div>            </div>            <div class="section">                <h3>临时对话</h3>                <p>临时对话，在 django 数据库中会在 7 天后自动删除</p>            </div>        </div>    </main>    <!-- ✅ 在这里引入 marked.js -->    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>    <script>        // 获取当前 prompt 列表        function getPromptOptions() {            const checkboxes = document.querySelectorAll('#prompt-checkbox-group input[type="checkbox"]');            return Array.from(checkboxes).map(cb => cb.value);        }        function openPromptManager() {            const editList = document.getElementById("prompt-edit-list");            editList.innerHTML = "";            const prompts = getPromptOptions();            prompts.forEach((text, idx) => {                const row = document.createElement("div");                row.innerHTML = `                    <input type="text" value="${text}" data-index="${idx}">                    <button onclick="deletePromptRow(this)">删除</button>                `;                editList.appendChild(row);            });            document.getElementById("prompt-manager").style.display = "block";        }        function closePromptManager() {            document.getElementById("prompt-manager").style.display = "none";        }        function deletePromptRow(btn) {            btn.parentElement.remove();        }        function addPromptOption() {            const newValue = document.getElementById("new-prompt-input").value.trim();            if (!newValue) return;            const row = document.createElement("div");            row.innerHTML = `                <input type="text" value="${newValue}">                <button onclick="deletePromptRow(this)">删除</button>            `;            document.getElementById("prompt-edit-list").appendChild(row);            document.getElementById("new-prompt-input").value = "";        }        function savePromptEdits() {            const inputs = document.querySelectorAll("#prompt-edit-list input[type='text']");            const values = Array.from(inputs).map(i => i.value.trim()).filter(v => v);            // 清空旧的 checkbox 区域            const group = document.getElementById("prompt-checkbox-group");            group.innerHTML = "";            // 重建 checkbox 列表            values.forEach(v => {                const label = document.createElement("label");                label.innerHTML = `<input type="checkbox" name="prompt" value="${v}"> ${v}`;                group.appendChild(label);            });            closePromptManager();        }        //展示对话        document.getElementById("send-button").addEventListener("click", function () {            const inputBox = document.getElementById("chat-input");            const chatWindow = document.getElementById("chat-window");            const usr_input = inputBox.value.trim();            if (!usr_input) return;            // 添加用户输入到 chat window（右边）            const userBubble = document.createElement("div");            userBubble.className = "chat-bubble user-bubble";            userBubble.innerHTML = marked.parse(usr_input);            chatWindow.appendChild(userBubble);            // 清空输入框            inputBox.value = "";            // 模拟 AI 回复（你之后可用 fetch 代替这里）            const ai_reply = `                **这是 AI 回复：**                - 支持 Markdown                - 支持代码块                \`\`\`python                print("Hello World")                \`\`\`                `;            // 延时模拟后端响应（可省略）            setTimeout(() => {                const aiBubble = document.createElement("div");                aiBubble.className = "chat-bubble ai-bubble";                aiBubble.innerHTML = marked.parse(ai_reply);                chatWindow.appendChild(aiBubble);                // 自动滚动到底部                chatWindow.scrollTop = chatWindow.scrollHeight;            }, 300);  // 假装等了下后端返回        });    </script></body></html>